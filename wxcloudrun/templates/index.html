<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>åå¤æ–‡éŸµ - ä¸­å›½ä¼ ç»Ÿæ–‡åŒ–é—¨æˆ·</title>
  
  <!-- ä¸­å›½é£å­—ä½“ -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  
  <style>
    :root {
      --chinese-red: #c41e3a;
      --chinese-gold: #d4af37;
      --chinese-jade: #00a86b;
      --chinese-black: #1a1a1a;
      --chinese-white: #faf8f3;
      --chinese-gray: #8b7355;
      --chinese-ink: #2c2c2c;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Serif SC', serif;
      background: linear-gradient(135deg, #faf8f3 0%, #f5f5dc 100%);
      color: var(--chinese-black);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* èƒŒæ™¯çº¹ç† */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(212, 175, 55, 0.03) 35px, rgba(212, 175, 55, 0.03) 70px),
        repeating-linear-gradient(-45deg, transparent, transparent 35px, rgba(196, 30, 58, 0.02) 35px, rgba(196, 30, 58, 0.02) 70px);
      pointer-events: none;
      z-index: 1;
    }

    .container {
      position: relative;
      z-index: 2;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }

    /* å¤´éƒ¨æ ·å¼ */
    .header {
      background: linear-gradient(135deg, var(--chinese-red) 0%, #8b0000 100%);
      color: var(--chinese-white);
      padding: 20px 0;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M0,50 Q25,30 50,50 T100,50" stroke="rgba(255,255,255,0.1)" stroke-width="2" fill="none"/></svg>');
      background-size: 100px 100px;
      opacity: 0.3;
    }

    .header-content {
      position: relative;
      z-index: 2;
      text-align: center;
    }

    .main-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      letter-spacing: 4px;
    }

    .subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      letter-spacing: 2px;
    }

    /* å¯¼èˆªæ  */
    .nav-tabs {
      border: none;
      background: var(--chinese-white);
      border-radius: 10px;
      padding: 5px;
      margin: 20px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .nav-tabs .nav-link {
      border: none;
      color: var(--chinese-gray);
      font-weight: 500;
      padding: 12px 20px;
      margin: 0 5px;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 1rem;
    }

    .nav-tabs .nav-link:hover {
      background: rgba(212, 175, 55, 0.1);
      color: var(--chinese-gold);
    }

    .nav-tabs .nav-link.active {
      background: var(--chinese-gold);
      color: var(--chinese-white);
      box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
    }

    /* å†…å®¹åŒºåŸŸ */
    .content-area {
      background: var(--chinese-white);
      border-radius: 15px;
      padding: 30px;
      margin: 20px 0;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
      border: 1px solid rgba(212, 175, 55, 0.2);
    }

    /* è¯—è¯å¡ç‰‡ */
    .poetry-card {
      background: linear-gradient(135deg, #fff9e6 0%, #fff3d3 100%);
      border-radius: 12px;
      padding: 25px;
      margin: 15px 0;
      border-left: 4px solid var(--chinese-gold);
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      transition: transform 0.3s ease;
    }

    .poetry-card:hover {
      transform: translateY(-2px);
    }

    .poetry-title {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--chinese-red);
      margin-bottom: 10px;
    }

    .poetry-author {
      color: var(--chinese-gray);
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .poetry-content {
      font-size: 1.1rem;
      line-height: 1.8;
      color: var(--chinese-black);
      text-align: center;
      margin: 20px 0;
    }

    /* æœç´¢æ¡† */
    .search-box {
      position: relative;
      margin: 20px 0;
    }

    .search-input {
      width: 100%;
      padding: 15px 50px 15px 20px;
      border: 2px solid rgba(212, 175, 55, 0.3);
      border-radius: 25px;
      font-size: 1rem;
      background: var(--chinese-white);
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--chinese-gold);
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
    }

    .search-btn {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--chinese-gold);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      color: var(--chinese-white);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .search-btn:hover {
      background: var(--chinese-red);
      transform: translateY(-50%) scale(1.1);
    }

    /* å­—ä½“è½¬æ¢å™¨ */
    .converter-box {
      background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
      border-radius: 12px;
      padding: 25px;
      margin: 20px 0;
      border: 1px solid rgba(0, 168, 107, 0.2);
    }

    .converter-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--chinese-jade);
      margin-bottom: 20px;
      text-align: center;
    }

    .converter-textarea {
      width: 100%;
      height: 120px;
      padding: 15px;
      border: 2px solid rgba(0, 168, 107, 0.3);
      border-radius: 10px;
      font-size: 1rem;
      resize: vertical;
      background: var(--chinese-white);
      margin: 10px 0;
    }

    .converter-textarea:focus {
      outline: none;
      border-color: var(--chinese-jade);
    }

    .converter-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }

    .converter-btn {
      background: var(--chinese-jade);
      color: var(--chinese-white);
      border: none;
      padding: 12px 25px;
      border-radius: 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .converter-btn:hover {
      background: var(--chinese-red);
      transform: translateY(-2px);
    }

    /* å†æ³•å¡ç‰‡ */
    .calendar-card {
      background: linear-gradient(135deg, #fff0f5 0%, #ffe6f0 100%);
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
      border-left: 4px solid var(--chinese-red);
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }

    .calendar-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--chinese-red);
      margin-bottom: 10px;
    }

    .calendar-date {
      color: var(--chinese-gray);
      font-size: 0.9rem;
      margin-bottom: 10px;
    }

    .calendar-content {
      color: var(--chinese-black);
      line-height: 1.6;
    }

    /* æŒ‰é’®æ ·å¼ */
    .action-btn {
      background: var(--chinese-gold);
      color: var(--chinese-white);
      border: none;
      padding: 12px 25px;
      border-radius: 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      margin: 5px;
    }

    .action-btn:hover {
      background: var(--chinese-red);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(196, 30, 58, 0.3);
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .main-title {
        font-size: 2rem;
      }
      
      .subtitle {
        font-size: 1rem;
      }
      
      .content-area {
        padding: 20px;
      }
      
      .nav-tabs .nav-link {
        padding: 10px 15px;
        font-size: 0.9rem;
      }
    }

    /* åŠ è½½åŠ¨ç”» */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--chinese-gray);
    }

    .loading i {
      font-size: 2rem;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* éšè—å†…å®¹åŒºåŸŸ */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* è£…é¥°å…ƒç´  */
    .decoration {
      position: absolute;
      opacity: 0.1;
      pointer-events: none;
    }

    .decoration.top-left {
      top: 10px;
      left: 10px;
      font-size: 3rem;
      color: var(--chinese-gold);
    }

    .decoration.bottom-right {
      bottom: 10px;
      right: 10px;
      font-size: 3rem;
      color: var(--chinese-red);
    }
  </style>
</head>

<body>
  <!-- å¤´éƒ¨ -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <h1 class="main-title">åå¤æ–‡éŸµ</h1>
        <p class="subtitle">ä¼ æ‰¿åƒå¹´æ–‡åŒ–ï¼Œå“å‘³è¯—è¯ä¹‹ç¾</p>
      </div>
    </div>
  </header>

  <!-- ä¸»è¦å†…å®¹ -->
  <div class="container">
    <!-- å¯¼èˆªæ ‡ç­¾ -->
    <ul class="nav nav-tabs" id="mainTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="poetry-tab" data-bs-toggle="tab" data-bs-target="#poetry" type="button" role="tab">
          <i class="fas fa-feather-alt"></i> è¯—è¯å¤©åœ°
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="etymology-tab" data-bs-toggle="tab" data-bs-target="#etymology" type="button" role="tab">
          <i class="fas fa-book-open"></i> è¯´æ–‡è§£å­—
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="calendar-tab" data-bs-toggle="tab" data-bs-target="#calendar" type="button" role="tab">
          <i class="fas fa-calendar-alt"></i> å†æ³•å¤©æ–‡
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="culture-tab" data-bs-toggle="tab" data-bs-target="#culture" type="button" role="tab">
          <i class="fas fa-book"></i> æ–‡åŒ–ç™¾ç§‘
        </button>
      </li>
    </ul>

    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="content-area">
      <!-- è¯—è¯å¤©åœ° -->
      <div class="tab-content active" id="poetry">
        <div class="decoration top-left">ğŸ“œ</div>
        <div class="decoration bottom-right">ğŸ‹</div>
        
        <div class="text-center mb-4">
          <h2 style="color: var(--chinese-red); font-weight: 600;">è¯—è¯å¤©åœ°</h2>
          <p style="color: var(--chinese-gray);">å“å‘³åƒå¹´è¯—è¯ï¼Œæ„Ÿå—ä¸­åæ–‡åŒ–ä¹‹ç¾</p>
        </div>

        <!-- æœç´¢æ¡† -->
        <div class="search-box">
          <input type="text" class="search-input" id="poetrySearch" placeholder="æœç´¢è¯—è¯ã€ä½œè€…æˆ–å…³é”®è¯...">
          <button class="search-btn" onclick="searchPoetry()">
            <i class="fas fa-search"></i>
          </button>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="text-center mb-4">
          <button class="action-btn" onclick="getRandomPoetry()">
            <i class="fas fa-random"></i> éšæœºè¯—è¯
          </button>
          <button class="action-btn" onclick="searchByAuthor()">
            <i class="fas fa-user"></i> æŒ‰ä½œè€…æœç´¢
          </button>
        </div>

        <!-- è¯—è¯å±•ç¤ºåŒºåŸŸ -->
        <div id="poetryResults">
          <div class="loading">
            <i class="fas fa-spinner"></i>
            <p>æ­£åœ¨åŠ è½½è¯—è¯...</p>
          </div>
        </div>
      </div>

      <!-- è¯´æ–‡è§£å­— -->
      <div class="tab-content" id="etymology">
        <div class="decoration top-left">ğŸ“–</div>
        <div class="decoration bottom-right">ğŸ”¤</div>
        
        <div class="text-center mb-4">
          <h2 style="color: var(--chinese-jade); font-weight: 600;">è¯´æ–‡è§£å­—</h2>
          <p style="color: var(--chinese-gray);">æ¢ç´¢æ±‰å­—å­—æºï¼Œä¼ æ‰¿åƒå¹´æ–‡åŒ–</p>
        </div>

        <!-- æ±‰å­—è¾“å…¥åŒºåŸŸ -->
        <div class="converter-box">
          <h3 class="converter-title">æ±‰å­—å­—æºæŸ¥è¯¢</h3>
          
          <div class="mb-3">
            <label for="characterInput" class="form-label">è¾“å…¥æ±‰å­—ï¼ˆä»…é™å•å­—ï¼‰ï¼š</label>
            <div class="input-group">
              <input type="text" class="form-control" id="characterInput" placeholder="è¯·è¾“å…¥å•ä¸ªæ±‰å­—..." maxlength="1" style="font-size: 1.5rem; text-align: center;">
              <button class="btn btn-primary" onclick="searchCharacterEtymology()">
                <i class="fas fa-search"></i> æŸ¥è¯¢
              </button>
            </div>
            <small class="form-text text-muted">åªèƒ½è¾“å…¥å•ä¸ªæ±‰å­—ï¼Œå¦‚ï¼šçˆ±ã€å›½ã€å­¦</small>
          </div>
        </div>

        <!-- å­—æºä¿¡æ¯å±•ç¤ºåŒºåŸŸ -->
        <div id="etymologyResults" style="display: none;">
          <!-- æ±‰å­—å¤§å­—å±•ç¤º -->
          <div class="text-center mb-4">
            <div id="characterDisplay" style="font-size: 6rem; font-weight: bold; color: var(--chinese-red); text-shadow: 2px 2px 4px rgba(0,0,0,0.1);"></div>
            <div id="pinyinDisplay" style="font-size: 1.5rem; color: var(--chinese-gray); margin-top: 10px;"></div>
          </div>

          <!-- åŸºæœ¬ä¿¡æ¯ -->
          <div class="row mb-4">
            <div class="col-md-4">
              <div class="calendar-card">
                <h4 class="calendar-title">éƒ¨é¦–</h4>
                <div id="radicalDisplay" class="calendar-content" style="font-size: 1.2rem; text-align: center;"></div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="calendar-card">
                <h4 class="calendar-title">ç¬”ç”»æ•°</h4>
                <div id="strokeCountDisplay" class="calendar-content" style="font-size: 1.2rem; text-align: center;"></div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="calendar-card">
                <h4 class="calendar-title">å­—å…¸æ¥æº</h4>
                <div id="sourceDisplay" class="calendar-content" style="font-size: 1rem; text-align: center;"></div>
              </div>
            </div>
          </div>

          <!-- å­—æºè§£é‡Š -->
          <div class="poetry-card">
            <h3 class="poetry-title">å­—æºè§£é‡Š</h3>
            <div id="etymologyDisplay" class="poetry-content" style="text-align: left;"></div>
          </div>

          <!-- æœ¬ä¹‰å’Œå¼•ç”³ä¹‰ -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="poetry-card">
                <h4 class="poetry-title">æœ¬ä¹‰</h4>
                <div id="meaningDisplay" class="poetry-content" style="text-align: left;"></div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="poetry-card">
                <h4 class="poetry-title">å¼•ç”³ä¹‰</h4>
                <div id="extendedMeaningsDisplay" class="poetry-content" style="text-align: left;"></div>
              </div>
            </div>
          </div>

          <!-- å¤æ–‡å­—å½¢æ€ -->
          <div class="poetry-card">
            <h3 class="poetry-title">å¤æ–‡å­—å½¢æ€</h3>
            <div id="ancientFormsDisplay" class="poetry-content" style="text-align: left; white-space: pre-line;"></div>
          </div>

          <!-- ç¬”é¡ºè¯´æ˜ -->
          <div class="poetry-card">
            <h3 class="poetry-title">ç¬”é¡ºè¯´æ˜</h3>
            <div id="strokeOrderDisplay" class="poetry-content" style="text-align: left;"></div>
          </div>

          <!-- ä¾‹è¯ä¾‹å¥ -->
          <div class="poetry-card">
            <h3 class="poetry-title">ä¾‹è¯ä¾‹å¥</h3>
            <div id="examplesDisplay" class="poetry-content" style="text-align: left;"></div>
          </div>

          <!-- ç›¸å…³æŸ¥è¯¢ -->
          <div class="text-center mt-4">
            <button class="action-btn" onclick="searchByRadical()">
              <i class="fas fa-search"></i> æŸ¥åŒéƒ¨é¦–å­—
            </button>
            <button class="action-btn" onclick="searchByStrokeCount()">
              <i class="fas fa-search"></i> æŸ¥åŒç¬”ç”»å­—
            </button>
            <button class="action-btn" onclick="clearEtymology()">
              <i class="fas fa-eraser"></i> æ¸…ç©º
            </button>
          </div>
        </div>

        <!-- æ— ç»“æœæç¤º -->
        <div id="noResults" style="display: none;" class="text-center">
          <div class="poetry-card">
            <h3 class="poetry-title">æœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯</h3>
            <p class="poetry-content">æŠ±æ­‰ï¼Œæš‚æœªæ”¶å½•è¯¥æ±‰å­—çš„å­—æºä¿¡æ¯ã€‚</p>
            <p class="poetry-content">æ‚¨å¯ä»¥å°è¯•æŸ¥è¯¢å…¶ä»–æ±‰å­—ï¼Œå¦‚ï¼šçˆ±ã€å›½ã€å­¦ç­‰ã€‚</p>
          </div>
        </div>
      </div>

      <!-- å†æ³•å¤©æ–‡ -->
      <div class="tab-content" id="calendar">
        <div class="decoration top-left">ğŸ“…</div>
        <div class="decoration bottom-right">ğŸŒŸ</div>
        
        <div class="text-center mb-4">
          <h2 style="color: var(--chinese-red); font-weight: 600;">å†æ³•å¤©æ–‡</h2>
          <p style="color: var(--chinese-gray);">æ¢ç´¢ä¸­å›½ä¼ ç»Ÿå†æ³•ä¸å¤©æ–‡çŸ¥è¯†</p>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="text-center mb-3">
              <h3 style="color: var(--chinese-gold);">äºŒåå››èŠ‚æ°”</h3>
              <button class="action-btn" onclick="getSolarTerms()">
                <i class="fas fa-sun"></i> æŸ¥çœ‹èŠ‚æ°”
              </button>
            </div>
            <div id="solarTermsResults"></div>
          </div>
          
          <div class="col-md-6">
            <div class="text-center mb-3">
              <h3 style="color: var(--chinese-gold);">ä¼ ç»ŸèŠ‚æ—¥</h3>
              <button class="action-btn" onclick="getFestivals()">
                <i class="fas fa-gift"></i> æŸ¥çœ‹èŠ‚æ—¥
              </button>
            </div>
            <div id="festivalsResults"></div>
          </div>
        </div>

        <div class="text-center mt-4">
          <h3 style="color: var(--chinese-gold);">äºŒåå…«æ˜Ÿå®¿</h3>
          <button class="action-btn" onclick="getConstellations()">
            <i class="fas fa-star"></i> æŸ¥çœ‹æ˜Ÿå®¿
          </button>
        </div>
        <div id="constellationsResults"></div>
      </div>

      <!-- æ–‡åŒ–ç™¾ç§‘ -->
      <div class="tab-content" id="culture">
        <div class="decoration top-left">ğŸ“š</div>
        <div class="decoration bottom-right">ğŸ®</div>
        
        <div class="text-center mb-4">
          <h2 style="color: var(--chinese-jade); font-weight: 600;">æ–‡åŒ–ç™¾ç§‘</h2>
          <p style="color: var(--chinese-gray);">æ¢ç´¢ä¸­åæ–‡åŒ–çš„åšå¤§ç²¾æ·±</p>
        </div>

        <div class="text-center mb-4">
          <button class="action-btn" onclick="getDailyCulture()">
            <i class="fas fa-lightbulb"></i> æ¯æ—¥æ–‡åŒ–
          </button>
          <button class="action-btn" onclick="getCultureByCategory('æˆè¯­')">
            <i class="fas fa-quote-left"></i> æˆè¯­æ•…äº‹
          </button>
          <button class="action-btn" onclick="getCultureByCategory('å†å²')">
            <i class="fas fa-landmark"></i> å†å²äººç‰©
          </button>
        </div>

        <div id="cultureResults">
          <div class="loading">
            <i class="fas fa-spinner"></i>
            <p>æ­£åœ¨åŠ è½½æ–‡åŒ–çŸ¥è¯†...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <script>
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    $(document).ready(function() {
      // åˆå§‹åŒ–æ•°æ®
      initData();
      
      // åŠ è½½éšæœºè¯—è¯
      getRandomPoetry();
      
      // åŠ è½½æ¯æ—¥æ–‡åŒ–
      getDailyCulture();
    });

    // åˆå§‹åŒ–æ•°æ®
    function initData() {
      $.ajax("/api/init-data", {
        method: "POST",
        contentType: "application/json; charset=utf-8",
        dataType: "json"
      }).done(function(res) {
        console.log("æ•°æ®åˆå§‹åŒ–æˆåŠŸ:", res);
      }).fail(function(err) {
        console.log("æ•°æ®åˆå§‹åŒ–å¤±è´¥:", err);
      });
    }

    // æ ‡ç­¾åˆ‡æ¢äº‹ä»¶
    document.addEventListener('DOMContentLoaded', function() {
      const tabs = document.querySelectorAll('[data-bs-toggle="tab"]');
      tabs.forEach(tab => {
        tab.addEventListener('shown.bs.tab', function (e) {
          // éšè—æ‰€æœ‰å†…å®¹
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
          });
          
          // æ˜¾ç¤ºå½“å‰å†…å®¹
          const targetId = e.target.getAttribute('data-bs-target');
          const targetContent = document.querySelector(targetId);
          if (targetContent) {
            targetContent.classList.add('active');
          }
        });
      });
    });

    // è¯—è¯ç›¸å…³å‡½æ•°
    function searchPoetry() {
      const keyword = $('#poetrySearch').val();
      if (!keyword) {
        alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
        return;
      }
      
      $('#poetryResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>æ­£åœ¨æœç´¢...</p></div>');
      
      $.ajax("/api/poetry/search?keyword=" + encodeURIComponent(keyword), {
        method: "GET"
      }).done(function(res) {
        displayPoetryResults(res.data);
      }).fail(function(err) {
        $('#poetryResults').html('<div class="text-center"><p>æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•</p></div>');
      });
    }

    function getRandomPoetry() {
      $('#poetryResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>æ­£åœ¨è·å–éšæœºè¯—è¯...</p></div>');
      
      $.ajax("/api/poetry/random", {
        method: "GET"
      }).done(function(res) {
        if (res.data) {
          displayPoetryResults([res.data]);
        } else {
          $('#poetryResults').html('<div class="text-center"><p>æš‚æ— è¯—è¯æ•°æ®</p></div>');
        }
      }).fail(function(err) {
        $('#poetryResults').html('<div class="text-center"><p>è·å–å¤±è´¥ï¼Œè¯·é‡è¯•</p></div>');
      });
    }

    function searchByAuthor() {
      const author = prompt('è¯·è¾“å…¥ä½œè€…å§“åï¼š');
      if (!author) return;
      
      $('#poetryResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>æ­£åœ¨æœç´¢...</p></div>');
      
      $.ajax("/api/poetry/search?author=" + encodeURIComponent(author), {
        method: "GET"
      }).done(function(res) {
        displayPoetryResults(res.data);
      }).fail(function(err) {
        $('#poetryResults').html('<div class="text-center"><p>æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•</p></div>');
      });
    }

    function displayPoetryResults(poems) {
      if (!poems || poems.length === 0) {
        $('#poetryResults').html('<div class="text-center"><p>æœªæ‰¾åˆ°ç›¸å…³è¯—è¯</p></div>');
        return;
      }
      
      let html = '';
      poems.forEach(poem => {
        html += `
          <div class="poetry-card">
            <h3 class="poetry-title">${poem.title}</h3>
            <p class="poetry-author">ã€${poem.dynasty}ã€‘${poem.author}</p>
            <div class="poetry-content">${poem.content}</div>
            ${poem.tags ? `<div class="text-center"><small style="color: var(--chinese-gray);">æ ‡ç­¾ï¼š${poem.tags}</small></div>` : ''}
          </div>
        `;
      });
      
      $('#poetryResults').html(html);
    }

    // è¯´æ–‡è§£å­—ç›¸å…³å‡½æ•°
    function searchCharacterEtymology() {
      const character = $('#characterInput').val().trim();
      
      if (!character) {
        alert('è¯·è¾“å…¥è¦æŸ¥è¯¢çš„æ±‰å­—');
        return;
      }
      
      if (character.length > 1) {
        alert('åªèƒ½è¾“å…¥å•ä¸ªæ±‰å­—');
        return;
      }
      
      // éªŒè¯æ˜¯å¦ä¸ºæ±‰å­—
      if (!/[\u4e00-\u9fa5]/.test(character)) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ±‰å­—');
        return;
      }
      
      $('#etymologyResults').hide();
      $('#noResults').hide();
      
      $.ajax("/api/etymology/search?character=" + encodeURIComponent(character), {
        method: "GET"
      }).done(function(res) {
        if (res.data) {
          displayEtymologyResults(res.data);
        } else {
          showNoResults();
        }
      }).fail(function(err) {
        alert('æŸ¥è¯¢å¤±è´¥ï¼Œè¯·é‡è¯•');
      });
    }

    function displayEtymologyResults(data) {
      // æ˜¾ç¤ºæ±‰å­—å’Œæ‹¼éŸ³
      $('#characterDisplay').text(data.character);
      $('#pinyinDisplay').text(data.pinyin || 'æš‚æ— æ‹¼éŸ³');
      
      // æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
      $('#radicalDisplay').text(data.radical || 'æš‚æ— éƒ¨é¦–ä¿¡æ¯');
      $('#strokeCountDisplay').text(data.stroke_count || 'æš‚æ— ç¬”ç”»ä¿¡æ¯');
      $('#sourceDisplay').text(data.dictionary_source || 'æš‚æ— æ¥æºä¿¡æ¯');
      
      // æ˜¾ç¤ºå­—æºè§£é‡Š
      $('#etymologyDisplay').html(data.etymology || 'æš‚æ— å­—æºè§£é‡Š');
      
      // æ˜¾ç¤ºæœ¬ä¹‰å’Œå¼•ç”³ä¹‰
      $('#meaningDisplay').html(data.meaning || 'æš‚æ— æœ¬ä¹‰è§£é‡Š');
      $('#extendedMeaningsDisplay').html(data.extended_meanings || 'æš‚æ— å¼•ç”³ä¹‰');
      
      // æ˜¾ç¤ºå¤æ–‡å­—å½¢æ€
      $('#ancientFormsDisplay').html(data.ancient_forms || 'æš‚æ— å¤æ–‡å­—å½¢æ€');
      
      // æ˜¾ç¤ºç¬”é¡ºè¯´æ˜
      $('#strokeOrderDisplay').html(data.stroke_order || 'æš‚æ— ç¬”é¡ºè¯´æ˜');
      
      // æ˜¾ç¤ºä¾‹è¯ä¾‹å¥
      $('#examplesDisplay').html(data.examples || 'æš‚æ— ä¾‹è¯ä¾‹å¥');
      
      $('#etymologyResults').show();
      
      // ä¿å­˜å½“å‰æ±‰å­—ä¿¡æ¯ç”¨äºç›¸å…³æŸ¥è¯¢
      window.currentCharacter = data;
    }

    function showNoResults() {
      $('#etymologyResults').hide();
      $('#noResults').show();
    }

    function searchByRadical() {
      if (!window.currentCharacter || !window.currentCharacter.radical) {
        alert('è¯·å…ˆæŸ¥è¯¢ä¸€ä¸ªæ±‰å­—');
        return;
      }
      
      const radical = window.currentCharacter.radical;
      $.ajax("/api/etymology/radical?radical=" + encodeURIComponent(radical), {
        method: "GET"
      }).done(function(res) {
        displayRelatedCharacters(res.data, 'åŒéƒ¨é¦–å­—ï¼š' + radical);
      }).fail(function(err) {
        alert('æŸ¥è¯¢å¤±è´¥ï¼Œè¯·é‡è¯•');
      });
    }

    function searchByStrokeCount() {
      if (!window.currentCharacter || !window.currentCharacter.stroke_count) {
        alert('è¯·å…ˆæŸ¥è¯¢ä¸€ä¸ªæ±‰å­—');
        return;
      }
      
      const strokeCount = window.currentCharacter.stroke_count;
      $.ajax("/api/etymology/strokes?count=" + strokeCount, {
        method: "GET"
      }).done(function(res) {
        displayRelatedCharacters(res.data, 'åŒç¬”ç”»å­—ï¼š' + strokeCount + 'ç”»');
      }).fail(function(err) {
        alert('æŸ¥è¯¢å¤±è´¥ï¼Œè¯·é‡è¯•');
      });
    }

    function displayRelatedCharacters(characters, title) {
      if (!characters || characters.length === 0) {
        alert('æœªæ‰¾åˆ°ç›¸å…³æ±‰å­—');
        return;
      }
      
      let html = '<div class="poetry-card"><h3 class="poetry-title">' + title + '</h3><div class="row">';
      characters.forEach(char => {
        html += `
          <div class="col-md-3 col-sm-4 col-6 text-center mb-3">
            <div style="cursor: pointer; padding: 10px; border-radius: 8px; background: rgba(212, 175, 55, 0.1);" 
                 onclick="quickSearch('${char.character}')">
              <div style="font-size: 2rem; font-weight: bold; color: var(--chinese-red);">${char.character}</div>
              <div style="font-size: 0.9rem; color: var(--chinese-gray);">${char.pinyin || ''}</div>
              <div style="font-size: 0.8rem; color: var(--chinese-gray);">${char.meaning || ''}</div>
            </div>
          </div>
        `;
      });
      html += '</div></div>';
      
      // åœ¨ç»“æœåŒºåŸŸå‰æ’å…¥ç›¸å…³æ±‰å­—
      $('#etymologyResults').prepend(html);
    }

    function quickSearch(character) {
      $('#characterInput').val(character);
      searchCharacterEtymology();
      
      // æ»šåŠ¨åˆ°é¡¶éƒ¨
      document.getElementById('etymology').scrollIntoView({ behavior: 'smooth' });
    }

    function clearEtymology() {
      $('#characterInput').val('');
      $('#etymologyResults').hide();
      $('#noResults').hide();
      window.currentCharacter = null;
    }

    // å†æ³•å¤©æ–‡ç›¸å…³å‡½æ•°
    function getSolarTerms() {
      $('#solarTermsResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>æ­£åœ¨åŠ è½½...</p></div>');
      
      $.ajax("/api/calendar/solar-terms", {
        method: "GET"
      }).done(function(res) {
        displayCalendarResults(res.data, 'solarTermsResults');
      }).fail(function(err) {
        $('#solarTermsResults').html('<div class="text-center"><p>åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</p></div>');
      });
    }

    function getFestivals() {
      $('#festivalsResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>æ­£åœ¨åŠ è½½...</p></div>');
      
      $.ajax("/api/calendar/festivals", {
        method: "GET"
      }).done(function(res) {
        displayCalendarResults(res.data, 'festivalsResults');
      }).fail(function(err) {
        $('#festivalsResults').html('<div class="text-center"><p>åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</p></div>');
      });
    }

    function getConstellations() {
      $('#constellationsResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>æ­£åœ¨åŠ è½½...</p></div>');
      
      $.ajax("/api/astronomy/constellations", {
        method: "GET"
      }).done(function(res) {
        displayAstronomyResults(res.data);
      }).fail(function(err) {
        $('#constellationsResults').html('<div class="text-center"><p>åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</p></div>');
      });
    }

    function displayCalendarResults(items, containerId) {
      if (!items || items.length === 0) {
        $('#' + containerId).html('<div class="text-center"><p>æš‚æ— æ•°æ®</p></div>');
        return;
      }
      
      let html = '';
      items.forEach(item => {
        html += `
          <div class="calendar-card">
            <h4 class="calendar-title">${item.title}</h4>
            ${item.date_info ? `<p class="calendar-date">${item.date_info}</p>` : ''}
            <div class="calendar-content">${item.content}</div>
          </div>
        `;
      });
      
      $('#' + containerId).html(html);
    }

    function displayAstronomyResults(items) {
      if (!items || items.length === 0) {
        $('#constellationsResults').html('<div class="text-center"><p>æš‚æ— æ•°æ®</p></div>');
        return;
      }
      
      let html = '<div class="row">';
      items.forEach(item => {
        html += `
          <div class="col-md-6">
            <div class="calendar-card">
              <h4 class="calendar-title">${item.title}</h4>
              ${item.constellation ? `<p class="calendar-date">æ˜Ÿå®¿ï¼š${item.constellation}</p>` : ''}
              ${item.period ? `<p class="calendar-date">æ—¶æœŸï¼š${item.period}</p>` : ''}
              <div class="calendar-content">${item.content}</div>
            </div>
          </div>
        `;
      });
      html += '</div>';
      
      $('#constellationsResults').html(html);
    }

    // æ–‡åŒ–ç™¾ç§‘ç›¸å…³å‡½æ•°
    function getDailyCulture() {
      $.ajax("/api/culture/daily", {
        method: "GET"
      }).done(function(res) {
        if (res.data) {
          displayCultureResults([res.data]);
        }
      }).fail(function(err) {
        console.log('è·å–æ¯æ—¥æ–‡åŒ–å¤±è´¥:', err);
      });
    }

    function getCultureByCategory(category) {
      $('#cultureResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>æ­£åœ¨åŠ è½½...</p></div>');
      
      $.ajax("/api/culture/category?category=" + encodeURIComponent(category), {
        method: "GET"
      }).done(function(res) {
        displayCultureResults(res.data);
      }).fail(function(err) {
        $('#cultureResults').html('<div class="text-center"><p>åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</p></div>');
      });
    }

    function displayCultureResults(items) {
      if (!items || items.length === 0) {
        $('#cultureResults').html('<div class="text-center"><p>æš‚æ— æ•°æ®</p></div>');
        return;
      }
      
      let html = '';
      items.forEach(item => {
        html += `
          <div class="poetry-card">
            <h3 class="poetry-title">${item.title}</h3>
            ${item.category ? `<p class="poetry-author">åˆ†ç±»ï¼š${item.category}</p>` : ''}
            <div class="poetry-content" style="text-align: left;">${item.content}</div>
            ${item.tags ? `<div class="text-center"><small style="color: var(--chinese-gray);">æ ‡ç­¾ï¼š${item.tags}</small></div>` : ''}
          </div>
        `;
      });
      
      $('#cultureResults').html(html);
    }

    // æœç´¢æ¡†å›è½¦äº‹ä»¶
    $('#poetrySearch').keypress(function(e) {
      if (e.which === 13) {
        searchPoetry();
      }
    });
  </script>
</body>
</html>
