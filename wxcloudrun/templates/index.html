<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>华夏文韵 - 中国传统文化门户</title>
  
  <!-- 中国风字体 -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  
  <style>
    :root {
      --chinese-red: #c41e3a;
      --chinese-gold: #d4af37;
      --chinese-jade: #00a86b;
      --chinese-black: #1a1a1a;
      --chinese-white: #faf8f3;
      --chinese-gray: #8b7355;
      --chinese-ink: #2c2c2c;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Serif SC', serif;
      background: linear-gradient(135deg, #faf8f3 0%, #f5f5dc 100%);
      color: var(--chinese-black);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* 背景纹理 */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(212, 175, 55, 0.03) 35px, rgba(212, 175, 55, 0.03) 70px),
        repeating-linear-gradient(-45deg, transparent, transparent 35px, rgba(196, 30, 58, 0.02) 35px, rgba(196, 30, 58, 0.02) 70px);
      pointer-events: none;
      z-index: 1;
    }

    .container {
      position: relative;
      z-index: 2;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }

    /* 头部样式 */
    .header {
      background: linear-gradient(135deg, var(--chinese-red) 0%, #8b0000 100%);
      color: var(--chinese-white);
      padding: 20px 0;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M0,50 Q25,30 50,50 T100,50" stroke="rgba(255,255,255,0.1)" stroke-width="2" fill="none"/></svg>');
      background-size: 100px 100px;
      opacity: 0.3;
    }

    .header-content {
      position: relative;
      z-index: 2;
      text-align: center;
    }

    .main-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      letter-spacing: 4px;
    }

    .subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      letter-spacing: 2px;
    }

    /* 导航栏 */
    .nav-tabs {
      border: none;
      background: var(--chinese-white);
      border-radius: 10px;
      padding: 5px;
      margin: 20px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .nav-tabs .nav-link {
      border: none;
      color: var(--chinese-gray);
      font-weight: 500;
      padding: 12px 20px;
      margin: 0 5px;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 1rem;
    }

    .nav-tabs .nav-link:hover {
      background: rgba(212, 175, 55, 0.1);
      color: var(--chinese-gold);
    }

    .nav-tabs .nav-link.active {
      background: var(--chinese-gold);
      color: var(--chinese-white);
      box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
    }

    /* 内容区域 */
    .content-area {
      background: var(--chinese-white);
      border-radius: 15px;
      padding: 30px;
      margin: 20px 0;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
      border: 1px solid rgba(212, 175, 55, 0.2);
    }

    /* 诗词卡片 */
    .poetry-card {
      background: linear-gradient(135deg, #fff9e6 0%, #fff3d3 100%);
      border-radius: 12px;
      padding: 25px;
      margin: 15px 0;
      border-left: 4px solid var(--chinese-gold);
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      transition: transform 0.3s ease;
    }

    .poetry-card:hover {
      transform: translateY(-2px);
    }

    .poetry-title {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--chinese-red);
      margin-bottom: 10px;
    }

    .poetry-author {
      color: var(--chinese-gray);
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .poetry-content {
      font-size: 1.1rem;
      line-height: 1.8;
      color: var(--chinese-black);
      text-align: center;
      margin: 20px 0;
    }

    /* 搜索框 */
    .search-box {
      position: relative;
      margin: 20px 0;
    }

    .search-input {
      width: 100%;
      padding: 15px 50px 15px 20px;
      border: 2px solid rgba(212, 175, 55, 0.3);
      border-radius: 25px;
      font-size: 1rem;
      background: var(--chinese-white);
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--chinese-gold);
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
    }

    .search-btn {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--chinese-gold);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      color: var(--chinese-white);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .search-btn:hover {
      background: var(--chinese-red);
      transform: translateY(-50%) scale(1.1);
    }

    /* 字体转换器 */
    .converter-box {
      background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
      border-radius: 12px;
      padding: 25px;
      margin: 20px 0;
      border: 1px solid rgba(0, 168, 107, 0.2);
    }

    .converter-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--chinese-jade);
      margin-bottom: 20px;
      text-align: center;
    }

    .converter-textarea {
      width: 100%;
      height: 120px;
      padding: 15px;
      border: 2px solid rgba(0, 168, 107, 0.3);
      border-radius: 10px;
      font-size: 1rem;
      resize: vertical;
      background: var(--chinese-white);
      margin: 10px 0;
    }

    .converter-textarea:focus {
      outline: none;
      border-color: var(--chinese-jade);
    }

    .converter-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }

    .converter-btn {
      background: var(--chinese-jade);
      color: var(--chinese-white);
      border: none;
      padding: 12px 25px;
      border-radius: 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .converter-btn:hover {
      background: var(--chinese-red);
      transform: translateY(-2px);
    }

    /* 历法卡片 */
    .calendar-card {
      background: linear-gradient(135deg, #fff0f5 0%, #ffe6f0 100%);
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
      border-left: 4px solid var(--chinese-red);
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }

    .calendar-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--chinese-red);
      margin-bottom: 10px;
    }

    .calendar-date {
      color: var(--chinese-gray);
      font-size: 0.9rem;
      margin-bottom: 10px;
    }

    .calendar-content {
      color: var(--chinese-black);
      line-height: 1.6;
    }

    /* 按钮样式 */
    .action-btn {
      background: var(--chinese-gold);
      color: var(--chinese-white);
      border: none;
      padding: 12px 25px;
      border-radius: 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      margin: 5px;
    }

    .action-btn:hover {
      background: var(--chinese-red);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(196, 30, 58, 0.3);
    }

    /* 响应式设计 */
    @media (max-width: 768px) {
      .main-title {
        font-size: 2rem;
      }
      
      .subtitle {
        font-size: 1rem;
      }
      
      .content-area {
        padding: 20px;
      }
      
      .nav-tabs .nav-link {
        padding: 10px 15px;
        font-size: 0.9rem;
      }
    }

    /* 加载动画 */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--chinese-gray);
    }

    .loading i {
      font-size: 2rem;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* 隐藏内容区域 */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* 装饰元素 */
    .decoration {
      position: absolute;
      opacity: 0.1;
      pointer-events: none;
    }

    .decoration.top-left {
      top: 10px;
      left: 10px;
      font-size: 3rem;
      color: var(--chinese-gold);
    }

    .decoration.bottom-right {
      bottom: 10px;
      right: 10px;
      font-size: 3rem;
      color: var(--chinese-red);
    }
  </style>
</head>

<body>
  <!-- 头部 -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <h1 class="main-title">华夏文韵</h1>
        <p class="subtitle">传承千年文化，品味诗词之美</p>
      </div>
    </div>
  </header>

  <!-- 主要内容 -->
  <div class="container">
    <!-- 导航标签 -->
    <ul class="nav nav-tabs" id="mainTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="poetry-tab" data-bs-toggle="tab" data-bs-target="#poetry" type="button" role="tab">
          <i class="fas fa-feather-alt"></i> 诗词天地
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="etymology-tab" data-bs-toggle="tab" data-bs-target="#etymology" type="button" role="tab">
          <i class="fas fa-book-open"></i> 说文解字
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="calendar-tab" data-bs-toggle="tab" data-bs-target="#calendar" type="button" role="tab">
          <i class="fas fa-calendar-alt"></i> 历法天文
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="culture-tab" data-bs-toggle="tab" data-bs-target="#culture" type="button" role="tab">
          <i class="fas fa-book"></i> 文化百科
        </button>
      </li>
    </ul>

    <!-- 内容区域 -->
    <div class="content-area">
      <!-- 诗词天地 -->
      <div class="tab-content active" id="poetry">
        <div class="decoration top-left">📜</div>
        <div class="decoration bottom-right">🎋</div>
        
        <div class="text-center mb-4">
          <h2 style="color: var(--chinese-red); font-weight: 600;">诗词天地</h2>
          <p style="color: var(--chinese-gray);">品味千年诗词，感受中华文化之美</p>
        </div>

        <!-- 搜索框 -->
        <div class="search-box">
          <input type="text" class="search-input" id="poetrySearch" placeholder="搜索诗词、作者或关键词...">
          <button class="search-btn" onclick="searchPoetry()">
            <i class="fas fa-search"></i>
          </button>
        </div>

        <!-- 操作按钮 -->
        <div class="text-center mb-4">
          <button class="action-btn" onclick="getRandomPoetry()">
            <i class="fas fa-random"></i> 随机诗词
          </button>
          <button class="action-btn" onclick="searchByAuthor()">
            <i class="fas fa-user"></i> 按作者搜索
          </button>
        </div>

        <!-- 诗词展示区域 -->
        <div id="poetryResults">
          <div class="loading">
            <i class="fas fa-spinner"></i>
            <p>正在加载诗词...</p>
          </div>
        </div>
      </div>

      <!-- 说文解字 -->
      <div class="tab-content" id="etymology">
        <div class="decoration top-left">📖</div>
        <div class="decoration bottom-right">🔤</div>
        
        <div class="text-center mb-4">
          <h2 style="color: var(--chinese-jade); font-weight: 600;">说文解字</h2>
          <p style="color: var(--chinese-gray);">探索汉字字源，传承千年文化</p>
        </div>

        <!-- 汉字输入区域 -->
        <div class="converter-box">
          <h3 class="converter-title">汉字字源查询</h3>
          
          <div class="mb-3">
            <label for="characterInput" class="form-label">输入汉字（仅限单字）：</label>
            <div class="input-group">
              <input type="text" class="form-control" id="characterInput" placeholder="请输入单个汉字..." maxlength="1" style="font-size: 1.5rem; text-align: center;">
              <button class="btn btn-primary" onclick="searchCharacterEtymology()">
                <i class="fas fa-search"></i> 查询
              </button>
            </div>
            <small class="form-text text-muted">只能输入单个汉字，如：爱、国、学</small>
          </div>
        </div>

        <!-- 字源信息展示区域 -->
        <div id="etymologyResults" style="display: none;">
          <!-- 汉字大字展示 -->
          <div class="text-center mb-4">
            <div id="characterDisplay" style="font-size: 6rem; font-weight: bold; color: var(--chinese-red); text-shadow: 2px 2px 4px rgba(0,0,0,0.1);"></div>
            <div id="pinyinDisplay" style="font-size: 1.5rem; color: var(--chinese-gray); margin-top: 10px;"></div>
          </div>

          <!-- 基本信息 -->
          <div class="row mb-4">
            <div class="col-md-4">
              <div class="calendar-card">
                <h4 class="calendar-title">部首</h4>
                <div id="radicalDisplay" class="calendar-content" style="font-size: 1.2rem; text-align: center;"></div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="calendar-card">
                <h4 class="calendar-title">笔画数</h4>
                <div id="strokeCountDisplay" class="calendar-content" style="font-size: 1.2rem; text-align: center;"></div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="calendar-card">
                <h4 class="calendar-title">字典来源</h4>
                <div id="sourceDisplay" class="calendar-content" style="font-size: 1rem; text-align: center;"></div>
              </div>
            </div>
          </div>

          <!-- 字源解释 -->
          <div class="poetry-card">
            <h3 class="poetry-title">字源解释</h3>
            <div id="etymologyDisplay" class="poetry-content" style="text-align: left;"></div>
          </div>

          <!-- 本义和引申义 -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="poetry-card">
                <h4 class="poetry-title">本义</h4>
                <div id="meaningDisplay" class="poetry-content" style="text-align: left;"></div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="poetry-card">
                <h4 class="poetry-title">引申义</h4>
                <div id="extendedMeaningsDisplay" class="poetry-content" style="text-align: left;"></div>
              </div>
            </div>
          </div>

          <!-- 古文字形态 -->
          <div class="poetry-card">
            <h3 class="poetry-title">古文字形态</h3>
            <div id="ancientFormsDisplay" class="poetry-content" style="text-align: left; white-space: pre-line;"></div>
          </div>

          <!-- 笔顺说明 -->
          <div class="poetry-card">
            <h3 class="poetry-title">笔顺说明</h3>
            <div id="strokeOrderDisplay" class="poetry-content" style="text-align: left;"></div>
          </div>

          <!-- 例词例句 -->
          <div class="poetry-card">
            <h3 class="poetry-title">例词例句</h3>
            <div id="examplesDisplay" class="poetry-content" style="text-align: left;"></div>
          </div>

          <!-- 相关查询 -->
          <div class="text-center mt-4">
            <button class="action-btn" onclick="searchByRadical()">
              <i class="fas fa-search"></i> 查同部首字
            </button>
            <button class="action-btn" onclick="searchByStrokeCount()">
              <i class="fas fa-search"></i> 查同笔画字
            </button>
            <button class="action-btn" onclick="clearEtymology()">
              <i class="fas fa-eraser"></i> 清空
            </button>
          </div>
        </div>

        <!-- 无结果提示 -->
        <div id="noResults" style="display: none;" class="text-center">
          <div class="poetry-card">
            <h3 class="poetry-title">未找到相关信息</h3>
            <p class="poetry-content">抱歉，暂未收录该汉字的字源信息。</p>
            <p class="poetry-content">您可以尝试查询其他汉字，如：爱、国、学等。</p>
          </div>
        </div>
      </div>

      <!-- 历法天文 -->
      <div class="tab-content" id="calendar">
        <div class="decoration top-left">📅</div>
        <div class="decoration bottom-right">🌟</div>
        
        <div class="text-center mb-4">
          <h2 style="color: var(--chinese-red); font-weight: 600;">历法天文</h2>
          <p style="color: var(--chinese-gray);">探索中国传统历法与天文知识</p>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="text-center mb-3">
              <h3 style="color: var(--chinese-gold);">二十四节气</h3>
              <button class="action-btn" onclick="getSolarTerms()">
                <i class="fas fa-sun"></i> 查看节气
              </button>
            </div>
            <div id="solarTermsResults"></div>
          </div>
          
          <div class="col-md-6">
            <div class="text-center mb-3">
              <h3 style="color: var(--chinese-gold);">传统节日</h3>
              <button class="action-btn" onclick="getFestivals()">
                <i class="fas fa-gift"></i> 查看节日
              </button>
            </div>
            <div id="festivalsResults"></div>
          </div>
        </div>

        <div class="text-center mt-4">
          <h3 style="color: var(--chinese-gold);">二十八星宿</h3>
          <button class="action-btn" onclick="getConstellations()">
            <i class="fas fa-star"></i> 查看星宿
          </button>
        </div>
        <div id="constellationsResults"></div>
      </div>

      <!-- 文化百科 -->
      <div class="tab-content" id="culture">
        <div class="decoration top-left">📚</div>
        <div class="decoration bottom-right">🏮</div>
        
        <div class="text-center mb-4">
          <h2 style="color: var(--chinese-jade); font-weight: 600;">文化百科</h2>
          <p style="color: var(--chinese-gray);">探索中华文化的博大精深</p>
        </div>

        <div class="text-center mb-4">
          <button class="action-btn" onclick="getDailyCulture()">
            <i class="fas fa-lightbulb"></i> 每日文化
          </button>
          <button class="action-btn" onclick="getCultureByCategory('成语')">
            <i class="fas fa-quote-left"></i> 成语故事
          </button>
          <button class="action-btn" onclick="getCultureByCategory('历史')">
            <i class="fas fa-landmark"></i> 历史人物
          </button>
        </div>

        <div id="cultureResults">
          <div class="loading">
            <i class="fas fa-spinner"></i>
            <p>正在加载文化知识...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <script>
    // 页面加载完成后初始化
    $(document).ready(function() {
      // 初始化数据
      initData();
      
      // 加载随机诗词
      getRandomPoetry();
      
      // 加载每日文化
      getDailyCulture();
    });

    // 初始化数据
    function initData() {
      $.ajax("/api/init-data", {
        method: "POST",
        contentType: "application/json; charset=utf-8",
        dataType: "json"
      }).done(function(res) {
        console.log("数据初始化成功:", res);
      }).fail(function(err) {
        console.log("数据初始化失败:", err);
      });
    }

    // 标签切换事件
    document.addEventListener('DOMContentLoaded', function() {
      const tabs = document.querySelectorAll('[data-bs-toggle="tab"]');
      tabs.forEach(tab => {
        tab.addEventListener('shown.bs.tab', function (e) {
          // 隐藏所有内容
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
          });
          
          // 显示当前内容
          const targetId = e.target.getAttribute('data-bs-target');
          const targetContent = document.querySelector(targetId);
          if (targetContent) {
            targetContent.classList.add('active');
          }
        });
      });
    });

    // 诗词相关函数
    function searchPoetry() {
      const keyword = $('#poetrySearch').val();
      if (!keyword) {
        alert('请输入搜索关键词');
        return;
      }
      
      $('#poetryResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>正在搜索...</p></div>');
      
      $.ajax("/api/poetry/search?keyword=" + encodeURIComponent(keyword), {
        method: "GET"
      }).done(function(res) {
        displayPoetryResults(res.data);
      }).fail(function(err) {
        $('#poetryResults').html('<div class="text-center"><p>搜索失败，请重试</p></div>');
      });
    }

    function getRandomPoetry() {
      $('#poetryResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>正在获取随机诗词...</p></div>');
      
      $.ajax("/api/poetry/random", {
        method: "GET"
      }).done(function(res) {
        if (res.data) {
          displayPoetryResults([res.data]);
        } else {
          $('#poetryResults').html('<div class="text-center"><p>暂无诗词数据</p></div>');
        }
      }).fail(function(err) {
        $('#poetryResults').html('<div class="text-center"><p>获取失败，请重试</p></div>');
      });
    }

    function searchByAuthor() {
      const author = prompt('请输入作者姓名：');
      if (!author) return;
      
      $('#poetryResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>正在搜索...</p></div>');
      
      $.ajax("/api/poetry/search?author=" + encodeURIComponent(author), {
        method: "GET"
      }).done(function(res) {
        displayPoetryResults(res.data);
      }).fail(function(err) {
        $('#poetryResults').html('<div class="text-center"><p>搜索失败，请重试</p></div>');
      });
    }

    function displayPoetryResults(poems) {
      if (!poems || poems.length === 0) {
        $('#poetryResults').html('<div class="text-center"><p>未找到相关诗词</p></div>');
        return;
      }
      
      let html = '';
      poems.forEach(poem => {
        html += `
          <div class="poetry-card">
            <h3 class="poetry-title">${poem.title}</h3>
            <p class="poetry-author">【${poem.dynasty}】${poem.author}</p>
            <div class="poetry-content">${poem.content}</div>
            ${poem.tags ? `<div class="text-center"><small style="color: var(--chinese-gray);">标签：${poem.tags}</small></div>` : ''}
          </div>
        `;
      });
      
      $('#poetryResults').html(html);
    }

    // 说文解字相关函数
    function searchCharacterEtymology() {
      const character = $('#characterInput').val().trim();
      
      if (!character) {
        alert('请输入要查询的汉字');
        return;
      }
      
      if (character.length > 1) {
        alert('只能输入单个汉字');
        return;
      }
      
      // 验证是否为汉字
      if (!/[\u4e00-\u9fa5]/.test(character)) {
        alert('请输入有效的汉字');
        return;
      }
      
      $('#etymologyResults').hide();
      $('#noResults').hide();
      
      $.ajax("/api/etymology/search?character=" + encodeURIComponent(character), {
        method: "GET"
      }).done(function(res) {
        if (res.data) {
          displayEtymologyResults(res.data);
        } else {
          showNoResults();
        }
      }).fail(function(err) {
        alert('查询失败，请重试');
      });
    }

    function displayEtymologyResults(data) {
      // 显示汉字和拼音
      $('#characterDisplay').text(data.character);
      $('#pinyinDisplay').text(data.pinyin || '暂无拼音');
      
      // 显示基本信息
      $('#radicalDisplay').text(data.radical || '暂无部首信息');
      $('#strokeCountDisplay').text(data.stroke_count || '暂无笔画信息');
      $('#sourceDisplay').text(data.dictionary_source || '暂无来源信息');
      
      // 显示字源解释
      $('#etymologyDisplay').html(data.etymology || '暂无字源解释');
      
      // 显示本义和引申义
      $('#meaningDisplay').html(data.meaning || '暂无本义解释');
      $('#extendedMeaningsDisplay').html(data.extended_meanings || '暂无引申义');
      
      // 显示古文字形态
      $('#ancientFormsDisplay').html(data.ancient_forms || '暂无古文字形态');
      
      // 显示笔顺说明
      $('#strokeOrderDisplay').html(data.stroke_order || '暂无笔顺说明');
      
      // 显示例词例句
      $('#examplesDisplay').html(data.examples || '暂无例词例句');
      
      $('#etymologyResults').show();
      
      // 保存当前汉字信息用于相关查询
      window.currentCharacter = data;
    }

    function showNoResults() {
      $('#etymologyResults').hide();
      $('#noResults').show();
    }

    function searchByRadical() {
      if (!window.currentCharacter || !window.currentCharacter.radical) {
        alert('请先查询一个汉字');
        return;
      }
      
      const radical = window.currentCharacter.radical;
      $.ajax("/api/etymology/radical?radical=" + encodeURIComponent(radical), {
        method: "GET"
      }).done(function(res) {
        displayRelatedCharacters(res.data, '同部首字：' + radical);
      }).fail(function(err) {
        alert('查询失败，请重试');
      });
    }

    function searchByStrokeCount() {
      if (!window.currentCharacter || !window.currentCharacter.stroke_count) {
        alert('请先查询一个汉字');
        return;
      }
      
      const strokeCount = window.currentCharacter.stroke_count;
      $.ajax("/api/etymology/strokes?count=" + strokeCount, {
        method: "GET"
      }).done(function(res) {
        displayRelatedCharacters(res.data, '同笔画字：' + strokeCount + '画');
      }).fail(function(err) {
        alert('查询失败，请重试');
      });
    }

    function displayRelatedCharacters(characters, title) {
      if (!characters || characters.length === 0) {
        alert('未找到相关汉字');
        return;
      }
      
      let html = '<div class="poetry-card"><h3 class="poetry-title">' + title + '</h3><div class="row">';
      characters.forEach(char => {
        html += `
          <div class="col-md-3 col-sm-4 col-6 text-center mb-3">
            <div style="cursor: pointer; padding: 10px; border-radius: 8px; background: rgba(212, 175, 55, 0.1);" 
                 onclick="quickSearch('${char.character}')">
              <div style="font-size: 2rem; font-weight: bold; color: var(--chinese-red);">${char.character}</div>
              <div style="font-size: 0.9rem; color: var(--chinese-gray);">${char.pinyin || ''}</div>
              <div style="font-size: 0.8rem; color: var(--chinese-gray);">${char.meaning || ''}</div>
            </div>
          </div>
        `;
      });
      html += '</div></div>';
      
      // 在结果区域前插入相关汉字
      $('#etymologyResults').prepend(html);
    }

    function quickSearch(character) {
      $('#characterInput').val(character);
      searchCharacterEtymology();
      
      // 滚动到顶部
      document.getElementById('etymology').scrollIntoView({ behavior: 'smooth' });
    }

    function clearEtymology() {
      $('#characterInput').val('');
      $('#etymologyResults').hide();
      $('#noResults').hide();
      window.currentCharacter = null;
    }

    // 历法天文相关函数
    function getSolarTerms() {
      $('#solarTermsResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>正在加载...</p></div>');
      
      $.ajax("/api/calendar/solar-terms", {
        method: "GET"
      }).done(function(res) {
        displayCalendarResults(res.data, 'solarTermsResults');
      }).fail(function(err) {
        $('#solarTermsResults').html('<div class="text-center"><p>加载失败，请重试</p></div>');
      });
    }

    function getFestivals() {
      $('#festivalsResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>正在加载...</p></div>');
      
      $.ajax("/api/calendar/festivals", {
        method: "GET"
      }).done(function(res) {
        displayCalendarResults(res.data, 'festivalsResults');
      }).fail(function(err) {
        $('#festivalsResults').html('<div class="text-center"><p>加载失败，请重试</p></div>');
      });
    }

    function getConstellations() {
      $('#constellationsResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>正在加载...</p></div>');
      
      $.ajax("/api/astronomy/constellations", {
        method: "GET"
      }).done(function(res) {
        displayAstronomyResults(res.data);
      }).fail(function(err) {
        $('#constellationsResults').html('<div class="text-center"><p>加载失败，请重试</p></div>');
      });
    }

    function displayCalendarResults(items, containerId) {
      if (!items || items.length === 0) {
        $('#' + containerId).html('<div class="text-center"><p>暂无数据</p></div>');
        return;
      }
      
      let html = '';
      items.forEach(item => {
        html += `
          <div class="calendar-card">
            <h4 class="calendar-title">${item.title}</h4>
            ${item.date_info ? `<p class="calendar-date">${item.date_info}</p>` : ''}
            <div class="calendar-content">${item.content}</div>
          </div>
        `;
      });
      
      $('#' + containerId).html(html);
    }

    function displayAstronomyResults(items) {
      if (!items || items.length === 0) {
        $('#constellationsResults').html('<div class="text-center"><p>暂无数据</p></div>');
        return;
      }
      
      let html = '<div class="row">';
      items.forEach(item => {
        html += `
          <div class="col-md-6">
            <div class="calendar-card">
              <h4 class="calendar-title">${item.title}</h4>
              ${item.constellation ? `<p class="calendar-date">星宿：${item.constellation}</p>` : ''}
              ${item.period ? `<p class="calendar-date">时期：${item.period}</p>` : ''}
              <div class="calendar-content">${item.content}</div>
            </div>
          </div>
        `;
      });
      html += '</div>';
      
      $('#constellationsResults').html(html);
    }

    // 文化百科相关函数
    function getDailyCulture() {
      $.ajax("/api/culture/daily", {
        method: "GET"
      }).done(function(res) {
        if (res.data) {
          displayCultureResults([res.data]);
        }
      }).fail(function(err) {
        console.log('获取每日文化失败:', err);
      });
    }

    function getCultureByCategory(category) {
      $('#cultureResults').html('<div class="loading"><i class="fas fa-spinner"></i><p>正在加载...</p></div>');
      
      $.ajax("/api/culture/category?category=" + encodeURIComponent(category), {
        method: "GET"
      }).done(function(res) {
        displayCultureResults(res.data);
      }).fail(function(err) {
        $('#cultureResults').html('<div class="text-center"><p>加载失败，请重试</p></div>');
      });
    }

    function displayCultureResults(items) {
      if (!items || items.length === 0) {
        $('#cultureResults').html('<div class="text-center"><p>暂无数据</p></div>');
        return;
      }
      
      let html = '';
      items.forEach(item => {
        html += `
          <div class="poetry-card">
            <h3 class="poetry-title">${item.title}</h3>
            ${item.category ? `<p class="poetry-author">分类：${item.category}</p>` : ''}
            <div class="poetry-content" style="text-align: left;">${item.content}</div>
            ${item.tags ? `<div class="text-center"><small style="color: var(--chinese-gray);">标签：${item.tags}</small></div>` : ''}
          </div>
        `;
      });
      
      $('#cultureResults').html(html);
    }

    // 搜索框回车事件
    $('#poetrySearch').keypress(function(e) {
      if (e.which === 13) {
        searchPoetry();
      }
    });
  </script>
</body>
</html>
